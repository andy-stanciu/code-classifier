/**
 * Definition for a binary tree node.
 * public class TreeNode {
 *     int val;
 *     TreeNode left;
 *     TreeNode right;
 *     TreeNode() {}
 *     TreeNode(int val) { this.val = val; }
 *     TreeNode(int val, TreeNode left, TreeNode right) {
 *         this.val = val;
 *         this.left = left;
 *         this.right = right;
 *     }
 * }
 */
class returnMaxPathSumHelper {

    public int maxLeaf;

    public int maxLocal;

    public returnMaxPathSumHelper(int maxLeaf, int maxLocal) {
        this.maxLeaf = maxLeaf;
        this.maxLocal = maxLocal;
    }
}

class Solution {

    private returnMaxPathSumHelper maxPathSumHelper(TreeNode root) {
        if (root.left == null && root.right == null) {
            returnMaxPathSumHelper ans = new returnMaxPathSumHelper(root.val, root.val);
            return ans;
        }
        returnMaxPathSumHelper ans1 = null;
        returnMaxPathSumHelper ans2 = null;
        if (root.left != null) {
            ans1 = maxPathSumHelper(root.left);
        }
        if (root.right != null) {
            ans2 = maxPathSumHelper(root.right);
        }
        if (ans1 != null && ans2 != null) {
            int maxLocal = Math.max(ans1.maxLeaf, Math.max(ans2.maxLeaf, Math.max(ans1.maxLocal, Math.max(ans2.maxLocal, root.val + ans1.maxLeaf + ans2.maxLeaf))));
            int maxLeaf = Math.max(root.val, Math.max(root.val + ans1.maxLeaf, root.val + ans2.maxLeaf));
            return new returnMaxPathSumHelper(maxLeaf, maxLocal);
        } else if (ans1 == null) {
            int maxLocal = Math.max(ans2.maxLocal, Math.max(ans2.maxLeaf, root.val + ans2.maxLeaf));
            int maxLeaf = Math.max(root.val, root.val + ans2.maxLeaf);
            return new returnMaxPathSumHelper(maxLeaf, maxLocal);
        } else {
            int maxLocal = Math.max(ans1.maxLocal, Math.max(ans1.maxLeaf, root.val + ans1.maxLeaf));
            int maxLeaf = Math.max(root.val, root.val + ans1.maxLeaf);
            return new returnMaxPathSumHelper(maxLeaf, maxLocal);
        }
    }

    public int maxPathSum(TreeNode root) {
        returnMaxPathSumHelper ans = maxPathSumHelper(root);
        return Math.max(ans.maxLeaf, ans.maxLocal);
    }
}
