class Solution {

    public int[] findOrder(int numCourses, int[][] prerequisites) {
        List<Integer> orderedCourses = new ArrayList<>();
        List<Integer>[] successors = new List[numCourses];
        int[] requirements = new int[numCourses];
        for (int i = 0; i < prerequisites.length; i++) {
            int x = prerequisites[i][0];
            int y = prerequisites[i][1];
            List<Integer> successorList = successors[y];
            if (successorList == null) {
                successorList = new ArrayList<>();
                successors[y] = successorList;
            }
            successorList.add(x);
            requirements[x]++;
        }
        for (int i = 0; i < numCourses; i++) {
            if (requirements[i] == 0) {
                orderCourses(i, orderedCourses, successors, requirements);
            }
        }
        if (orderedCourses.size() != numCourses) {
            return new int[0];
        }
        return orderedCourses.stream().mapToInt(Integer::intValue).toArray();
    }

    private void orderCourses(int i, List<Integer> orderedCourses, List<Integer>[] successors, int[] requirements) {
        requirements[i]--;
        if (requirements[i] > 0) {
            return;
        }
        orderedCourses.add(i);
        requirements[i]--;
        List<Integer> successorList = successors[i];
        if (successorList == null) {
            return;
        }
        for (int successor : successorList) {
            orderCourses(successor, orderedCourses, successors, requirements);
        }
    }
}
