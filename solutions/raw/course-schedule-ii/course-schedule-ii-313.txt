class Solution {

    public int[] findOrder(int numCourses, int[][] prerequisites) {
        int[] visited = new int[numCourses];
        int[] ordering = new int[numCourses];
        List<Integer>[] adj = getAdjacencyList(numCourses, prerequisites);
        int i = numCourses - 1;
        for (int j = 0; j < numCourses && i >= 0; j++) {
            i = dfs(visited, ordering, adj, j, i);
            if (i == -5)
                return new int[] {};
        }
        return ordering;
    }

    private int dfs(int[] visited, int[] ordering, List<Integer>[] adj, int v, int i) {
        if (visited[v] == 1)
            return i;
        if (visited[v] == -5)
            return -5;
        visited[v] = -5;
        for (Integer neighbour : adj[v]) {
            i = dfs(visited, ordering, adj, neighbour, i);
            if (i == -5)
                return -5;
        }
        visited[v] = 1;
        ordering[i] = v;
        return i - 1;
    }

    private List<Integer>[] getAdjacencyList(int numCourses, int[][] prerequisites) {
        List<Integer>[] adj = new ArrayList[numCourses];
        for (int i = 0; i < numCourses; i++) {
            adj[i] = new ArrayList<>();
        }
        for (int[] req : prerequisites) {
            adj[req[1]].add(req[0]);
        }
        return adj;
    }
}
