class Solution {

    int pos;

    List<Integer>[] adj;

    int[] result;

    boolean[] visitedInCycle;

    boolean[] visited;

    public int[] findOrder(int numCourses, int[][] prerequisites) {
        adj = new List[numCourses];
        visitedInCycle = new boolean[numCourses];
        visited = new boolean[numCourses];
        result = new int[numCourses];
        for (int i = 0; i < adj.length; i++) {
            adj[i] = new ArrayList<>();
        }
        for (int i = 0; i < prerequisites.length; i++) {
            int[] pre = prerequisites[i];
            adj[pre[0]].add(pre[1]);
        }
        pos = 0;
        for (int i = 0; i < numCourses; i++) {
            if (isInCycle(i))
                return new int[] {};
        }
        return result;
    }

    private boolean isInCycle(int src) {
        if (visitedInCycle[src])
            return true;
        if (visited[src])
            return false;
        visitedInCycle[src] = true;
        for (Integer pre : adj[src]) {
            if (isInCycle(pre))
                return true;
        }
        result[pos] = src;
        pos++;
        visited[src] = true;
        visitedInCycle[src] = false;
        return false;
    }
}
