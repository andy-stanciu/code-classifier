class Solution {

    public String minWindow(String s, String t) {
        if (t.length() > s.length())
            return "";
        // the core of the problem is comparing two maps which
        // should be fine because only 42 elements to compare?
        // and the good thing is we only need to do it when the substring length >= t
        int m = s.length();
        int n = t.length();
        Map<Character, Integer> tFreqMap = new HashMap<>();
        for (int i = 0; i < n; i++) {
            tFreqMap.put(t.charAt(i), tFreqMap.getOrDefault(t.charAt(i), 0) + 1);
        }
        int leftPointer = 0;
        int minLength = Integer.MAX_VALUE;
        String minWindowString = "";
        Map<Character, Integer> sFreqMap = new HashMap<>();
        for (int i = 0; i < m; i++) {
            char c = s.charAt(i);
            // only care if c is present in tFreqMap
            if (tFreqMap.containsKey(c)) {
                sFreqMap.put(c, sFreqMap.getOrDefault(c, 0) + 1);
                // compare the two maps
                while (sFreqMap.size() == tFreqMap.size() && compareMaps(sFreqMap, tFreqMap)) {
                    int currentLength = i - leftPointer + 1;
                    if (currentLength < minLength) {
                        minWindowString = s.substring(leftPointer, i + 1);
                        minLength = currentLength;
                    }
                    // shrink the window by finding the next element that is present in the tFreqMap
                    // first remove the character at leftPointer
                    char leftChar = s.charAt(leftPointer);
                    sFreqMap.put(leftChar, sFreqMap.get(leftChar) - 1);
                    if (sFreqMap.get(leftChar) == 0) {
                        sFreqMap.remove(leftChar);
                    }
                    leftPointer++;
                    while (leftPointer < i && !sFreqMap.containsKey(s.charAt(leftPointer))) leftPointer++;
                }
            } else {
                if (sFreqMap.size() == 0)
                    leftPointer++;
            }
        }
        return minWindowString;
    }

    // Every character freq in sMap should be >= tMap
    public boolean compareMaps(Map<Character, Integer> sMap, Map<Character, Integer> tMap) {
        for (char c : tMap.keySet()) {
            int tFreq = tMap.get(c);
            int sFreq = sMap.getOrDefault(c, 0);
            if (sFreq < tFreq)
                return false;
        }
        return true;
    }
}
