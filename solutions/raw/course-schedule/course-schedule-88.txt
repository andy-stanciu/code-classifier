class Solution {

    boolean cycle = false;

    public boolean canFinish(int numCourses, int[][] prerequisites) {
        ArrayList<Integer>[] graph = new ArrayList[numCourses];
        for (int i = 0; i < numCourses; i++) {
            graph[i] = new ArrayList();
        }
        for (int i = 0; i < prerequisites.length; i++) {
            graph[prerequisites[i][0]].add(prerequisites[i][1]);
        }
        int[] visited = new int[numCourses];
        int[] recStack = new int[numCourses];
        for (int i = 0; i < numCourses; i++) {
            if (visited[i] == 0) {
                detectCycle(graph, visited, recStack, i);
            }
            if (cycle)
                return false;
        }
        return true;
    }

    private void detectCycle(ArrayList<Integer>[] graph, int[] visited, int[] recStack, int v) {
        if (cycle)
            return;
        visited[v] = 1;
        recStack[v] = 1;
        for (int i = 0; i < graph[v].size(); i++) {
            if (recStack[graph[v].get(i)] == 1) {
                cycle = true;
                return;
            }
            if (visited[graph[v].get(i)] == 0) {
                detectCycle(graph, visited, recStack, graph[v].get(i));
            }
        }
        recStack[v] = 0;
    }
}
